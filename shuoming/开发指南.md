# 进销存管理系统 - 开发指南

## 开发环境搭建

### 前置要求
- Node.js 18+ 
- Python 3.9+
- MySQL 8.0+
- Git

### 1. 克隆项目
```bash
git clone <repository-url>
cd wuyong
```

### 2. 前端环境配置
```bash
cd frontend

# 安装依赖
npm install

# 复制环境配置文件
cp .env.example .env

# 启动开发服务器
npm run dev
```

### 3. 后端环境配置
```bash
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 复制环境配置文件
cp .env.example .env

# 启动开发服务器
python run.py
```

### 4. 数据库配置
```sql
-- 创建数据库
CREATE DATABASE wuyong_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 创建用户并授权
CREATE USER 'wuyong_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON wuyong_db.* TO 'wuyong_user'@'localhost';
FLUSH PRIVILEGES;
```

## 开发规范

### 代码风格

#### 前端代码规范
```typescript
// ✅ 正确的命名
const ProductList = () => {};
const fetchProductData = async () => {};
const API_BASE_URL = 'http://localhost:8000';

// ❌ 错误的命名
const productlist = () => {};
const FetchProductData = async () => {};
const api_base_url = 'http://localhost:8000';
```

#### 后端代码规范
```python
# ✅ 正确的命名
def create_product(product_data: dict) -> Product:
    pass

class ProductService:
    pass

# ❌ 错误的命名
def CreateProduct(productData: dict) -> Product:
    pass

class product_service:
    pass
```

### Git提交规范

```bash
# 提交类型
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具变动

# 提交示例
feat: 添加产品管理页面
fix: 修复登录页面样式问题
docs: 更新API文档
```

### API开发规范

#### 请求/响应格式
```typescript
// 请求数据 (蛇形命名)
{
  "product_name": "笔记本电脑",
  "product_code": "NB001",
  "unit_price": 5999.00
}

// 响应数据 (蛇形命名)
{
  "success": true,
  "data": {
    "uuid": "123e4567-e89b-12d3-a456-426614174000",
    "product_name": "笔记本电脑",
    "created_at": "2024-01-15T10:30:00Z"
  },
  "message": "操作成功"
}
```

#### 错误处理
```typescript
// 错误响应格式
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "产品名称不能为空",
  "details": {
    "field": "product_name",
    "message": "不能为空"
  }
}
```

## 开发流程

### 1. 功能开发流程

#### 前端开发步骤
1. 创建页面组件 (`src/pages/`)
2. 定义TypeScript类型 (`src/types/`)
3. 创建API服务 (`src/services/`)
4. 实现业务逻辑
5. 编写样式
6. 添加单元测试

#### 后端开发步骤
1. 创建数据模型 (`app/models/`)
2. 定义Pydantic模式 (`app/schemas/`)
3. 实现业务逻辑 (`app/services/`)
4. 创建API路由 (`app/routes/`)
5. 编写单元测试

### 2. 数据库变更流程

#### 新增表
```python
# 1. 创建模型文件
# app/models/new_table.py

# 2. 在主应用中导入模型
# app/main.py
from app.models.new_table import NewTable

# 3. 数据库会自动创建表结构
```

#### 修改表结构
```python
# 1. 修改模型定义
# app/models/existing_table.py

# 2. 创建数据库迁移脚本
# 需要手动处理或使用Alembic
```

### 3. API开发流程

#### 新增API端点
```python
# 1. 在对应的路由文件中添加端点
# app/routes/products.py

@router.post("/Products/Batch")
async def batch_create_products(products_data: List[CreateProductRequest]):
    # 实现业务逻辑
    pass
```

#### 前端调用API
```typescript
// 1. 在API客户端中添加方法
// src/services/api/client.ts

async batchCreateProducts(productsData: CreateProductRequest[]): Promise<Product[]> {
    const response = await this.client.post<ApiResponse<Product[]>>('/api/v1/Products/Batch', productsData);
    return response.data.data;
}

// 2. 在组件中使用
const handleBatchCreate = async () => {
    try {
        const result = await apiClient.batchCreateProducts(products);
        // 处理结果
    } catch (error) {
        // 错误处理
    }
};
```

## 测试指南

### 前端测试
```typescript
// 单元测试示例
import { render, screen } from '@testing-library/react';
import ProductList from './ProductList';

describe('ProductList', () => {
    it('应该显示产品列表', () => {
        render(<ProductList />);
        expect(screen.getByText('产品列表')).toBeInTheDocument();
    });
});
```

### 后端测试
```python
# 单元测试示例
import pytest
from app.services.product_service import ProductService

class TestProductService:
    @pytest.mark.asyncio
    async def test_create_product(self):
        # 测试创建产品
        product_data = {
            "product_name": "测试产品",
            "product_code": "TEST001"
        }
        
        result = await ProductService.create_product(product_data)
        assert result.product_name == "测试产品"
```

### 集成测试
```python
# API集成测试
from fastapi.testclient import TestClient
from app.main import app

client = TestClient(app)

def test_create_product():
    response = client.post("/api/v1/Products", json={
        "product_name": "测试产品",
        "product_code": "TEST001"
    })
    
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
```

## 调试技巧

### 前端调试

#### React Developer Tools
- 安装Chrome扩展
- 查看组件状态和props
- 性能分析

#### 网络请求调试
```typescript
// 在API客户端中添加日志
this.client.interceptors.request.use((config) => {
    console.log('请求:', config.method, config.url, config.data);
    return config;
});

this.client.interceptors.response.use((response) => {
    console.log('响应:', response.status, response.data);
    return response;
});
```

### 后端调试

#### 日志配置
```python
import logging

# 设置日志级别
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# 在代码中添加日志
logger.debug(f"处理产品创建请求: {product_data}")
```

#### 数据库查询调试
```python
# 启用SQL查询日志
import logging

logging.getLogger('sqlalchemy.engine').setLevel(logging.INFO)
```

## 性能优化

### 前端优化

#### 代码分割
```typescript
// 使用React.lazy进行懒加载
const ProductPage = lazy(() => import('./pages/ProductPage'));

// 路由配置中使用Suspense
<Suspense fallback={<LoadingSpinner />}>
    <Routes>
        <Route path="/products" element={<ProductPage />} />
    </Routes>
</Suspense>
```

#### 图片优化
```typescript
// 使用WebP格式图片
// 实现懒加载
// 使用CDN加速
```

### 后端优化

#### 数据库优化
```python
# 添加索引
# 使用连接池
# 优化查询语句
```

#### 缓存策略
```python
# 使用Redis缓存
# 实现缓存失效策略
# 数据库查询缓存
```

## 部署指南

### 生产环境配置

#### 前端构建
```bash
cd frontend
npm run build
```

#### 后端部署
```bash
cd backend

# 安装生产依赖
pip install -r requirements.txt

# 设置生产环境变量
export DEBUG=false
export DATABASE_URL=mysql+aiomysql://user:pass@host/db

# 使用生产服务器
uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4
```

### 监控和日志

#### 应用监控
- 使用Prometheus收集指标
- 使用Grafana展示仪表板
- 设置告警规则

#### 日志管理
- 结构化日志记录
- 日志轮转策略
- 错误日志监控

## 常见问题解决

### 前端常见问题

#### 跨域问题
```typescript
// 后端需要配置CORS
// 前端开发服务器代理配置
```

#### 样式问题
```css
/* 检查Tailwind CSS配置 */
/* 确保样式文件正确导入 */
```

### 后端常见问题

#### 数据库连接问题
```python
# 检查数据库连接字符串
# 验证数据库服务状态
# 检查网络连接
```

#### 依赖问题
```bash
# 清理虚拟环境
rm -rf venv
python -m venv venv
pip install -r requirements.txt
```

## 贡献指南

### 代码审查
- 所有代码必须通过ESLint检查
- 重要功能必须包含单元测试
- API变更必须更新文档

### 问题报告
- 使用标准的问题模板
- 提供复现步骤
- 包含环境信息

### 功能请求
- 描述业务需求
- 提供使用场景
- 讨论技术实现方案