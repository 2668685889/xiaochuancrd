# 进销存管理系统 - 移植说明

## 项目概述

本项目是一个基于Python FastAPI和React的进销存管理系统，包含完整的数据库管理、用户权限、采购管理、销售管理、库存管理等功能。

## 系统要求

### 软件要求
- Python 3.9+
- Node.js 16+
- MySQL 8.0+
- Redis (可选，用于缓存)

### 硬件要求
- 内存：至少4GB
- 磁盘空间：至少2GB

## 环境配置

### 1. 克隆项目
```bash
git clone <项目仓库地址>
cd xiaochuancrd
```

### 2. 后端环境配置

#### 创建虚拟环境
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows
```

#### 安装依赖
```bash
pip install -r requirements.txt
```

#### 数据库配置
1. 创建MySQL数据库
```sql
CREATE DATABASE xiaochuanERP CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 配置环境变量
复制 `.env.example` 为 `.env` 并修改数据库连接信息：
```bash
cp .env.example .env
```

编辑 `.env` 文件：
```env
DATABASE_URL=mysql+aiomysql://root:your_password@localhost/xiaochuanERP
```

#### 数据库初始化
```bash
# 创建数据库表
python create_tables.sql

# 或使用Alembic迁移
python init_mysql.py

# 初始化测试数据
python insert_test_data.py
```

### 3. 前端环境配置

#### 安装依赖
```bash
cd frontend
npm install
```

#### 环境配置
复制 `.env.example` 为 `.env` 并修改API地址：
```env
VITE_API_URL=http://localhost:8000/api
```

## 数据库迁移

### Alembic迁移系统
项目已配置Alembic数据库迁移系统，用于管理数据库版本变更。

#### 常用命令
```bash
# 查看当前迁移状态
alembic current

# 生成新的迁移文件
alembic revision --autogenerate -m "描述变更内容"

# 应用迁移
alembic upgrade head

# 回滚迁移
alembic downgrade -1

# 查看迁移历史
alembic history
```

#### 迁移流程
1. 修改数据库模型
2. 生成迁移文件：`alembic revision --autogenerate -m "变更描述"`
3. 检查生成的迁移文件
4. 应用迁移：`alembic upgrade head`

### 现有数据库处理
如果数据库已存在表结构，使用以下命令标记当前状态：
```bash
alembic stamp head
```

## 开发环境启动

### 后端服务
```bash
cd backend
python run.py
```
后端服务将在 http://localhost:8000 启动

### 前端服务
```bash
cd frontend
npm run dev
```
前端服务将在 http://localhost:3000 启动

### API文档
启动后端服务后，可访问以下地址查看API文档：
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## 生产环境部署

### 1. 环境准备
确保生产环境满足系统要求，安装必要的软件包。

### 2. 数据库配置
```bash
# 创建生产数据库
mysql -u root -p -e "CREATE DATABASE xiaochuanERP_prod CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 备份现有数据（如有）
mysqldump -u root -p xiaochuanERP > backup.sql

# 恢复数据到生产环境
mysql -u root -p xiaochuanERP_prod < backup.sql
```

### 3. 后端部署
```bash
cd backend

# 安装生产依赖
pip install -r requirements.txt

# 配置生产环境变量
cp .env.example .env.production
# 编辑 .env.production 文件，设置生产数据库连接等

# 使用生产模式启动
python run.py
```

### 4. 前端部署
```bash
cd frontend

# 构建生产版本
npm run build

# 部署构建文件到Web服务器
# build/ 目录包含所有静态文件
```

### 5. 使用Docker部署（可选）
项目支持Docker部署，具体配置参考 `docker-compose.yml` 文件。

## 测试

### 后端测试
```bash
cd backend

# 运行所有测试
python -m pytest

# 运行特定测试文件
python -m pytest test_specific_module.py

# 生成测试覆盖率报告
python -m pytest --cov=app --cov-report=html
```

### 前端测试
```bash
cd frontend

# 运行单元测试
npm test

# 运行E2E测试
npm run test:e2e

# 运行ESLint检查
npm run lint
```

## 代码质量

### ESLint配置
项目使用ESLint进行代码质量检查：
```bash
cd frontend

# 检查代码规范
npm run lint

# 自动修复可修复的问题
npm run lint:fix
```

### 代码格式化
使用Prettier进行代码格式化：
```bash
cd frontend

# 格式化代码
npm run format

# 检查格式化
npm run format:check
```

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 验证数据库连接字符串
   - 检查防火墙设置

2. **依赖安装失败**
   - 检查Python/Node.js版本
   - 清理缓存重新安装：`npm cache clean --force` 或 `pip cache purge`

3. **迁移失败**
   - 检查Alembic配置
   - 验证数据库权限
   - 查看迁移文件语法

### 日志查看
- 后端日志：查看控制台输出或日志文件
- 前端日志：浏览器开发者工具
- 数据库日志：MySQL错误日志

## 维护和更新

### 定期维护任务
1. 备份数据库
2. 更新依赖包
3. 检查日志文件
4. 性能监控

### 版本更新流程
1. 备份当前版本和数据
2. 拉取最新代码
3. 运行数据库迁移
4. 更新依赖包
5. 测试新功能
6. 部署到生产环境

## 技术支持

如有问题，请联系开发团队或查看项目文档。

---

*最后更新：2025年10月17日*