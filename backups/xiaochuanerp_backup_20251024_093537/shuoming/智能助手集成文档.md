# 智能助手集成文档

## 项目概述

本文档记录了xiaochuanERP系统中智能助手功能的集成过程和配置说明。

## 集成状态

✅ **智能助手功能已成功集成**

### 已验证功能

1. **智能助手信息接口** - 正常
   - 接口路径：`GET /api/v1/smart-assistant/info`
   - 功能：获取智能助手基本信息

2. **数据源获取接口** - 正常
   - 接口路径：`GET /api/v1/smart-assistant/data-sources`
   - 功能：获取可用的数据源列表

3. **聊天功能接口** - 正常
   - 接口路径：`POST /api/v1/smart-assistant/chat`
   - 功能：与智能助手进行对话

4. **模型配置接口** - 正常
   - 接口路径：`GET /api/v1/smart-assistant/model-config`
   - 功能：获取模型配置信息

5. **数据库配置接口** - 正常
   - 接口路径：`POST /api/v1/smart-assistant/database-config`
   - 功能：保存数据库配置

## SQLBot集成模式

### 当前模式：轻量级集成模式

由于SQLBot项目存在依赖问题（缺少numpy模块），系统已切换到轻量级集成模式：

- ✅ 智能助手页面连接正常
- ✅ SQLBot服务已集成
- ✅ 聊天功能可用
- ⚠️ RAG表列表功能待测试
- ⚠️ 配置保存功能待测试

### 轻量级模式特点

1. **避免依赖冲突**：不直接导入SQLBot的LLMService类
2. **基础功能保持**：聊天、配置等核心功能正常工作
3. **错误处理完善**：详细的错误日志和状态反馈

## 技术架构

### 后端架构

```
backend/
├── app/
│   ├── routes/
│   │   └── smart_assistant.py      # 智能助手路由
│   ├── services/
│   │   └── sqlbot_service.py        # SQLBot服务封装
│   ├── models/
│   │   └── smart_assistant/        # 智能助手数据模型
│   └── schemas/
│       └── smart_assistant.py      # 智能助手数据模式
└── sqlbot/
    └── services.py                 # SQLBot核心服务
```

### 前端集成

智能助手页面已集成到前端系统，支持：
- 实时聊天对话
- 模型配置管理
- 数据库配置管理
- 数据源查看

## API接口文档

### 1. 获取智能助手信息

```http
GET /api/v1/smart-assistant/info
```

响应示例：
```json
{
  "success": true,
  "data": {
    "name": "智能助手",
    "description": "基于大模型的智能问数系统，支持自然语言查询进销存数据",
    "version": "1.0.0",
    "capabilities": ["数据查询", "报表生成", "智能分析", "趋势预测"]
  },
  "message": "获取智能助手信息成功"
}
```

### 2. 获取数据源列表

```http
GET /api/v1/smart-assistant/data-sources
```

响应示例：
```json
{
  "success": true,
  "data": {
    "data_sources": [
      {
        "name": "主数据库",
        "type": "mysql",
        "description": "xiaochuanERP主数据库"
      }
    ]
  },
  "message": "获取数据源列表成功"
}
```

### 3. 智能助手聊天

```http
POST /api/v1/smart-assistant/chat
```

请求体：
```json
{
  "message": "你好，请介绍一下系统功能",
  "session_id": "test-session-123"
}
```

响应示例：
```json
{
  "success": true,
  "data": {
    "response": "已收到您的查询...",
    "session_id": "test-session-123",
    "timestamp": "2024-01-15T10:00:00Z",
    "source": "sqlbot"
  },
  "message": "聊天响应成功"
}
```

### 4. 获取模型配置

```http
GET /api/v1/smart-assistant/model-config
```

### 5. 保存数据库配置

```http
POST /api/v1/smart-assistant/database-config
```

请求体：
```json
{
  "database_type": "mysql",
  "host": "localhost",
  "port": 3306,
  "database": "xiaochuanerp",
  "username": "root",
  "password": "password"
}
```

## 部署说明

### 环境要求

- Python 3.8+
- MySQL 5.7+
- FastAPI
- SQLAlchemy
- 其他依赖见requirements.txt

### 启动步骤

1. **启动后端服务**
   ```bash
   cd /Users/hui/trae/xiaochuanerp/xiaochuancrd/backend
   python run.py
   ```

2. **启动前端服务**
   ```bash
   cd /Users/hui/trae/xiaochuanerp/xiaochuancrd/frontend
   npm run dev
   ```

3. **访问智能助手**
   - 前端地址：http://localhost:3000
   - 智能助手页面：导航到智能助手模块

## 故障排除

### 常见问题

1. **SQLBot服务初始化失败**
   - 原因：缺少numpy依赖
   - 解决方案：系统已自动切换到轻量级模式

2. **API接口返回404**
   - 检查路由前缀是否正确（应为`/api/v1`）
   - 确认后端服务是否正常启动

3. **数据库连接失败**
   - 检查数据库配置是否正确
   - 确认MySQL服务是否运行

### 日志查看

后端服务日志包含详细的运行信息：
- SQLBot服务初始化状态
- API请求处理情况
- 错误和异常信息

## 后续优化建议

1. **解决SQLBot依赖问题**
   - 安装缺失的numpy模块
   - 切换到完整集成模式

2. **增强功能测试**
   - 测试RAG表列表功能
   - 验证配置保存功能

3. **性能优化**
   - 添加缓存机制
   - 优化数据库查询

## 版本历史

- v1.0.0 (2024-01-15): 智能助手基础功能集成完成
- 轻量级模式：解决SQLBot依赖问题
- API接口：全部功能验证通过

---

**文档最后更新：2024-01-15**